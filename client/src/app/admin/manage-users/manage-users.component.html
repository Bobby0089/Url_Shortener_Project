<app-nav></app-nav>
<div class="main">
  <main class="container">
    <h2 class="section-title">All Users</h2>

    <!-- Filters -->
    <div class="filters">
      <input 
        type="text" 
        placeholder="Filter by Username" 
        [(ngModel)]="filterUsername">
      <input 
        type="text" 
        placeholder="Filter by First Name" 
        [(ngModel)]="filterFirstName">
      <input 
        type="text" 
        placeholder="Filter by Last Name" 
        [(ngModel)]="filterLastName">
    </div>

    <!-- Filter Buttons -->
    <div class="filter-buttons">
      <button type="button" class="apply-btn" (click)="onSearch()">Apply Filters</button>
      <button type="button" class="remove-btn" (click)="clearFilters()">Remove Filters</button>
    </div>

    <!-- Download CSV Button -->
    <button class="download-btn" (click)="downloadCSV()">Download CSV</button>

    <!-- Results Info -->
    <div class="results-info" *ngIf="userArray.length !== allUsers.length">
      Showing {{ userArray.length }} of {{ allUsers.length }} users on this page
    </div>

    <!-- Users Table -->
    <table *ngIf="userArray.length > 0">
      <thead>
        <tr>
          <th>Sr No.</th>
          <th>Username</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Total Revenue</th>
          <th>Plans</th>
          <th>URLs</th>
          <th>Deactivate</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of userArray; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.firstName || user.firstname }}</td>
          <td>{{ user.lastName || user.lastname }}</td>
          <td>{{ user.revenue || 0 }}</td>
          <td><button class="view-btn" (click)="viewPlans(user)">View Plans</button></td>
          <td><button class="view-btn" (click)="viewURLs(user)">View URLs</button></td>
          <td><button type="button" class="deactivate-btn" (click)="getId(user.id)">Deactivate</button></td>
        </tr>
      </tbody>
    </table>

    <!-- No Results Message -->
    <div class="no-results" *ngIf="userArray.length === 0 && allUsers.length > 0">
      No users found matching the current filters.
    </div>

    <!-- No Data Message -->
    <div class="no-data" *ngIf="allUsers.length === 0">
      No users available.
    </div>

    <!-- Pagination -->
    <ul class="pagination" *ngIf="totalPages > 1">
      <li class="page-item" [class.disabled]="pagenumber == 1">
        <button class="page-link" (click)="onPageChange(pagenumber - 1)" [disabled]="pagenumber == 1">
          Previous
        </button>
      </li>

      <li
        class="page-item"
        *ngFor="let page of getPageNumbers()"
        [class.active]="page === pagenumber"
      >
        <button class="page-link" (click)="onPageChange(page)">
          {{ page }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="pagenumber == totalPages">
        <button class="page-link" (click)="onPageChange(pagenumber + 1)" [disabled]="pagenumber == totalPages">
          Next
        </button>
      </li>
    </ul>

    <!-- Pagination Info -->
    <div class="pagination-info" *ngIf="totalRecords > 0">
      Page {{ pagenumber }} of {{ totalPages }} ({{ totalRecords }} total users)
    </div>
  </main>
</div>
<app-footer></app-footer>