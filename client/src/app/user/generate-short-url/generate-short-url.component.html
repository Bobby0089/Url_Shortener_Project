<app-nav></app-nav>

<div class="main">
    <div class="page-container">
        <!-- Page Title (outside the container) -->
        <h1 class="page-title">Generate Short URL</h1>

        <!-- Loading Indicator -->
        <div *ngIf="isLoading" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading...</p>
        </div>

        <!-- Main Container -->
        <div class="main-container" *ngIf="!isLoading">
            <form class="url-form" (ngSubmit)="generateShortUrl()" #urlForm="ngForm">
                <div class="form-group">
                    <label for="long-url">Enter Long URL:</label>
                    <input 
                        type="url" 
                        id="long-url" 
                        name="long-url" 
                        [(ngModel)]="longUrl"
                        placeholder="https://example.com/very-long-url"
                        required
                        #longUrlInput="ngModel">
                    <div *ngIf="longUrlInput.invalid && longUrlInput.touched" class="error-message">
                        Please enter a valid URL
                    </div>
                </div>

                <div class="form-group">
                    <label for="plan">Select Plan:</label>
                    <select 
                        id="planSelect" 
                        name="selectedPlanId" 
                        [(ngModel)]="selectedPlanId" 
                        required
                        #planSelect="ngModel">
                        <option value="">Select a Plan</option>
                        <option *ngFor="let plan of userplans" [value]="plan.id">
                            {{ plan.planname }} (Remaining: {{ plan.urllimit }})
                        </option>
                    </select>
                    <div *ngIf="planSelect.invalid && planSelect.touched" class="error-message">
                        Please select a plan
                    </div>
                </div>

                <!-- Custom URL Toggle -->
                <div class="form-group">
                    <label class="checkbox-container">
                        <input 
                            type="checkbox" 
                            [(ngModel)]="customUrlEnabled"
                            name="customUrlEnabled"
                            >
                        <span class="checkmark"></span>
                        Use Custom URL
                    </label>
                </div>

                <!-- Custom URL Input (shown when enabled) -->
                <div class="form-group" *ngIf="customUrlEnabled">
                    <label for="custom-url">Custom URL:</label>
                    <input 
                        type="text" 
                        id="custom-url" 
                        name="custom-url" 
                        [(ngModel)]="customUrl"
                        placeholder="my-custom-url"
                        pattern="[a-zA-Z0-9-_]+"
                        #customUrlInput="ngModel">
                    <div *ngIf="customUrlInput.invalid && customUrlInput.touched" class="error-message">
                        Custom URL can only contain letters, numbers, hyphens, and underscores
                    </div>
                    <small class="help-text">Only letters, numbers, hyphens (-), and underscores (_) are allowed</small>
                </div>

                <button 
                    type="submit" 
                    class="submit-btn"
                    [disabled]="urlForm.invalid || !userplans.length">
                    {{ customUrlEnabled ? 'Generate Custom Short URL' : 'Generate Short URL' }}
                </button>
            </form>

            <!-- Display Generated Short URL -->
            <div *ngIf="shortUrl" class="result-container">
                <h3>Your Short URL:</h3>
                <div class="short-url-display">
                    <input 
                        type="text" 
                        [value]="shortUrl" 
                        readonly 
                        #shortUrlInput
                        class="short-url-input">
                    <button 
                        type="button" 
                        class="copy-btn"
                        (click)="copyToClipboard(shortUrlInput.value)"
                        [routerLink]="['/user/Redirect']">
                        Copy
                    </button>
                </div>
            </div>

            <!-- User Plans Info -->
            <div *ngIf="userplans.length === 0 && userid" class="no-plans-message">
                <p>No URL plans available. Please purchase a plan to generate short URLs.</p>
            </div>
        </div>
    </div>
</div>

<hr>
<app-footer></app-footer>   

<!-- 108    *ngIf="userPlans.length === 0 && user" -->
 <!-- 101   (click)="copyToClipboard(shortUrlInput.value)" -->